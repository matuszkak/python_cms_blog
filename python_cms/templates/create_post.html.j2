{% extends 'base.html.j2' %}

{% block headsource %}
 {{ ckeditor.load() }}
{% endblock %}


{% block title %} Home {% endblock %}

{% block content %}
  
  {% if edit is defined and edit == True %}
    <h1>Edit post</h1>
  {% else %}
    <h1>Create post</h1>
  {% endif %}
  
  {% for message in get_flashed_messages()  %}
   <div class="toast toast-success">
       <button class="btn btn-clear float-right"></button>
         {{message}}
   </div>
   {% endfor %}

  {% for field, errors in form.errors.items() %}
    {% for error in errors %}
      <div class="toast toast-error">
          <button class="btn btn-clear float-right"></button>
            {{error}}
      </div>
    {% endfor %}
  {% endfor %}

 {% if edit is defined and edit == True %}
<form action="/post/edit/{{ post_id }}" method="POST" class="form-group" enctype="multipart/form-data">
 {% else %}
<form action="/add" method="POST" class="form-group" enctype="multipart/form-data">
 {% endif %}

 {# protect against csrf https://portswigger.net/web-security/csrf/tokens #}
 {{ form.csrf_token() }}

 <input type="hidden" value="{{ form.teaser_image.data }}" name="original_teaser_image" id="originalTeaserImage">
 
 <label for="title"> {{ form.title.label }}</label>
 {{ form.title(class="form-input", placeholder="title")}}
 <label for="teaser_image"> {{ form.teaser_image.label }}</label>

 {% if edit is defined and edit == True and teaser_image != "" %}
    <div class="card", id="img-and-del-button-container">
      <img src="/files/{{teaser_image}}" class="img-responsive article-image-inner del-butt" alt="">
      <button type="button" class="btn tooltip delete-btn delete-img-btn del-butt" data-tooltip="delete image", id="img-del-button"> Delete </button>
    </div> 
    {{ form.teaser_image(class="form-input hidden", id="teaser-image-input")}}
   


 {% else %}
    {{ form.teaser_image(class="form-input")}}


 {% endif %}

 <label class="form-label">{{ form.category.label }}</label>
 {% for subfield in form.category %}
 <label class="form-radio form-inline">
   {{ subfield }}
   <i class="form-icon"></i> {{ subfield.label.text }}
 </label>
 {% endfor %}

 <label for="body" class="form-label"> {{ form.body.label }}</label>
 {{ form.body(class="form-input", placeholder="your article goes here", id='body')}}
 
 {% if edit is defined and edit == True: %}
    {{ form.submit(class="btn btn-primary input-group-btn float-right", id="createPost", value="Save")}}
 {% else: %}
    {{ form.submit(class="btn btn-primary input-group-btn float-right", id="createPost")}}
 {% endif %}  

  <div class="form-group">
    <label class="form-switch"> 
      <input for= {{ form.promoted }}
      <i class="form-icon"></i> {{ form.promoted.label }}
    </label>
  </div>

 </form>

 {{ ckeditor.config(name='body') }}
 
{% endblock %}


{% block bodysource %}
<script src="{{url_for('static', filename="create_post.js")}}"></script>
{% endblock %}




